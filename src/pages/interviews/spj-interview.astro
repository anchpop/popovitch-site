---
import Layout from "../../layouts/Layout.astro";
import { parseInterviewMarkdown } from "../../utils/parseInterviewMarkdown.js";
import fs from "fs";
import path from "path";

// Read and parse the markdown interview
const markdownPath = path.join(process.cwd(), "src/content/spj_interview.md");
const markdownContent = fs.readFileSync(markdownPath, "utf-8");
const interview = parseInterviewMarkdown(markdownContent);
---

<Layout>
  <div class="interview-container">
    <div class="interview-content">
      <h1>Pursuing a Trick a Long Way Just To See Where It Goes, with Simon Peyton Jones</h1>

      <p>
        Contact me via
        <a href="https://x.com/ChadNauseam">Twitter</a>,
        <a href="https://discord.gg/mpgqfsH">Discord</a>, or
        <a href="mailto:contact@chadnauseam.com">email</a>.
      </p>

      <div class="video-container">
        <iframe
          width="560"
          height="315"
          src="https://www.youtube.com/embed/Ow55c-m-_Ak"
          title="Pursuing a Trick a Long Way Just To See Where It Goes, with Simon Peyton Jones"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        >
        </iframe>
      </div>

      <div class="interview-details">
        <h2>About this Interview</h2>
        <p>
          This interview explores the history and design philosophy of Haskell, 
          a purely functional programming language, through an in-depth conversation 
          with Simon Peyton Jones, one of its creators. We discuss what makes Haskell 
          unique, the evolution of its type system including typeclasses and higher-kinded 
          types, and how it serves as a laboratory for exploring programming language ideas.
        </p>

        <p>
          The interview was conducted without a script and has been lightly
          edited for clarity.
        </p>

        <h2>About Simon Peyton Jones</h2>
        <p>
          Simon Peyton Jones is a British computer scientist who is one of the 
          designers of the Haskell programming language and a major contributor to 
          the Glasgow Haskell Compiler (GHC). He has been a researcher at Microsoft 
          Research Cambridge and is now an Engineering Fellow at Epic Games. His 
          research interests include functional programming languages, type systems, 
          and compiler technology.
        </p>
        <p>
          Simon has made fundamental contributions to the field of programming 
          languages, including work on typeclasses, software transactional memory (STM), 
          and the development of GHC's typed intermediate language. He is known for 
          his ability to bridge the gap between theoretical computer science and 
          practical software engineering, making advanced concepts accessible and 
          useful to working programmers.
        </p>

        <div class="topics">
          <h3>Topics Covered:</h3>
          <ul>
            <li>The origins of Haskell and the goals of the Haskell Committee</li>
            <li>Functional programming fundamentals and the Lambda calculus</li>
            <li>Lazy vs. strict evaluation and its implications</li>
            <li>The development and impact of typeclasses</li>
            <li>Higher-kinded types and their interaction with subtyping</li>
            <li>Variance, covariance, and contravariance in type systems</li>
            <li>The comparison between parametric polymorphism and subtyping</li>
            <li>GHC's typed intermediate language (System FC)</li>
            <li>The role of static type systems in software longevity</li>
            <li>Haskell's purity and the development of monads for I/O</li>
            <li>Software transactional memory (STM) in Haskell</li>
            <li>The future of Haskell and the Haskell Foundation</li>
            <li>Haskell as a laboratory for programming language research</li>
          </ul>
        </div>

        <div class="transcript">
          <h2>Interview Transcript</h2>
          {
            interview.map((item, index) => {
              if (item.heading) {
                return <h3>{item.heading}</h3>;
              } else if (item.speaker) {
                // Check if this is a continuation of the previous speaker
                const prevItem = index > 0 ? interview[index - 1] : null;
                const isContinuation = prevItem && prevItem.speaker === item.speaker;
                
                if (isContinuation) {
                  // Just show the text without the speaker name
                  return (
                    <p class="continuation">
                      <span class="text">{item.text}</span>
                    </p>
                  );
                } else {
                  // Show speaker name and text
                  return (
                    <p>
                      <span class="speaker">{item.speaker}</span>:{" "}
                      <span class="text">{item.text}</span>
                    </p>
                  );
                }
              }
            })
          }
        </div>

        <a href="/" class="back-button">‚Üê Back to Home</a>
      </div>
    </div>
  </div>

  <style>
    .interview-container {
      display: flex;
      justify-content: center;
      padding: 2rem 1rem;
      min-height: 100vh;
    }

    .interview-content {
      max-width: 800px;
      width: 100%;
      background-color: var(--card-bg);
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-size: 2.5rem;
      margin: 0 0 1.5rem 0;
      color: var(--text-color);
    }

    h2 {
      font-size: 1.8rem;
      margin: 2rem 0 1rem;
      color: var(--text-color);
    }

    h3 {
      font-size: 1.4rem;
      margin: 1.5rem 0 0.75rem;
      color: var(--text-color);
    }

    p {
      margin: 1rem 0;
      font-size: 1.1rem;
      line-height: 1.6;
      color: var(--text-color);
    }

    .video-container {
      position: relative;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
      overflow: hidden;
      margin: 2rem 0;
      border-radius: 8px;
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 8px;
    }

    .interview-details {
      margin-top: 2rem;
    }

    ul {
      margin: 0.5rem 0 1.5rem 1.5rem;
    }

    li {
      margin: 0.5rem 0;
      font-size: 1.1rem;
      line-height: 1.5;
    }

    .topics {
      background-color: rgba(var(--accent-color-rgb, 50, 69, 255), 0.05);
      padding: 1.5rem;
      border-radius: 8px;
      margin: 2rem 0;
    }

    .transcript {
      margin-top: 3rem;
    }

    .transcript h3 {
      margin-top: 2rem;
      font-size: 1.5rem;
      color: var(--accent-color);
    }

    .transcript p {
      margin: 1rem 0;
      line-height: 1.7;
    }

    .transcript p.continuation {
      margin-top: 1rem;
      margin-bottom: 1rem;
    }

    .transcript .speaker {
      font-weight: bold;
      display: inline;
    }

    .back-button {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background: var(--accent-color);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition:
        transform 0.2s ease,
        opacity 0.2s ease;
    }

    .back-button:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .interview-content {
        padding: 1.5rem;
      }

      h1 {
        font-size: 2rem;
      }

      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</Layout>